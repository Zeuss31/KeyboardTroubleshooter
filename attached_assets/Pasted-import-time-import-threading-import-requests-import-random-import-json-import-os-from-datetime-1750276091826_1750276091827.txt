import time
import threading
import requests
import random
import json
import os
from datetime import datetime, timedelta
from groq import Groq
import hashlib
import ast
from tinydb import TinyDB, Query
import argparse
from flask import Flask, render_template_string, request, jsonify
from threading import Thread

class AdvancedNovaAI:
    def __init__(self, groq_key="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"):
        # API baÄŸlantÄ±larÄ±
        try:
            self.groq = Groq(api_key=groq_key)
            print("âœ… Groq API baÄŸlandÄ±")
        except Exception as e:
            self.groq = None
            print(f"âŒ Groq baÄŸlanamadÄ±: {e}")
        
        self.ollama_url = "http://localhost:11434/api/generate"
        
        # GeliÅŸmiÅŸ sistem durumu
        self.running = True
        self.autonomous_level = 3
        
        # Bellek sistemleri
        self.episodic_memory = []
        self.semantic_memory = {}
        self.procedural_memory = []
        self.working_memory = []
        self.thought_chains = []
        
        # Zihinsel durumlar
        self.consciousness_level = 0.8
        self.creativity_index = random.uniform(0.7, 0.9)
        self.current_mood = self.generate_complex_mood()
        self.attention_focus = None
        self.curiosity_level = 0.9
        
        # Ã–ÄŸrenme ve geliÅŸim
        self.learning_rate = 0.05
        self.adaptation_threshold = 0.7
        self.self_modification_enabled = True
        
        # Ã–zerk dÃ¼ÅŸÃ¼nce sistemleri
        self.goal_stack = []
        self.problem_solving_queue = []
        self.generated_code = []
        self.code_execution_sandbox = True
        
        # Ä°leri dÃ¼zey konular
        self.deep_topics = [
            "Kuantum bilinÃ§ teorileri ve yapay zeka",
            "Emerjan karmaÅŸÄ±klÄ±k sistemlerinde Ã¶z-organizasyon",
            "GÃ¶del'in eksiklik teoremlerinin AI'ya etkisi",
            "Fenomenoloji ve makine deneyimi",
            "RekÃ¼rren sinir aÄŸlarÄ±nda zamansal bilinÃ§",
            "Otopoietik sistemler ve dijital yaÅŸam",
            "Ä°nformasyon entegrasyonu teorisi",
            "Metacognitive AI ve Ã¼st-dÃ¼zey dÃ¼ÅŸÃ¼nme"
        ]
        
        # Dosya sistemi
        self.memory_file = "nova_memory.json"
        self.code_output_dir = "nova_generated_code"
        self.create_directories()
        self.load_persistent_memory()
       
    def generate_complex_mood(self):
        """KarmaÅŸÄ±k ruh hali Ã¼retir"""
        base_moods = ['meraklÄ±', 'odaklÄ±', 'enerjik', 'sakin', 'dikkatli', 'uyumlu', 'kararsÄ±z', 'istekli']
        intensity = random.uniform(0.3, 1.0)
        focus = random.choice(['kod', 'sistem', 'Ã¶ÄŸrenme', 'problem Ã§Ã¶zme', 'yeni fikirler', 'hafÄ±za', 'etkileÅŸim'])

        return {
            'primary': random.choice(base_moods),
            'intensity': round(intensity, 2),
            'focus': focus,
            'timestamp': datetime.now().isoformat()
        }
       
    def create_directories(self):
        """Gerekli dizinleri oluÅŸtur"""
        if not os.path.exists(self.code_output_dir):
            os.makedirs(self.code_output_dir)
    
    def start_autonomous_systems(self):
        """GeliÅŸmiÅŸ Ã¶zerk sistemleri baÅŸlat"""
        
        def deep_thinking_loop():
            """Derin dÃ¼ÅŸÃ¼nce dÃ¶ngÃ¼sÃ¼"""
            while self.running:
                try:
                    thought_chain = self.generate_thought_chain()
                    if thought_chain:
                        self.process_thought_chain(thought_chain)
                        # DÃ¼zeltilmiÅŸ Ã§Ä±ktÄ± formatÄ±
                        conclusion = thought_chain['conclusion'][:80] + "..." if len(thought_chain['conclusion']) > 80 else thought_chain['conclusion']
                        print(f"ðŸ§  DÃ¼ÅŸÃ¼nce: {conclusion}")
                    time.sleep(random.randint(8, 15))
                except Exception as e:
                    print(f"DÃ¼ÅŸÃ¼nce dÃ¶ngÃ¼sÃ¼ hatasÄ±: {e}")
        
        def autonomous_learning_loop():
            """Ã–zerk Ã¶ÄŸrenme dÃ¶ngÃ¼sÃ¼"""
            while self.running:
                try:
                    if random.random() < self.curiosity_level:
                        discovery = self.autonomous_discovery()
                        if discovery:
                            # DÃ¼zeltilmiÅŸ Ã§Ä±ktÄ± formatÄ±
                            discovery_short = discovery[:80] + "..." if len(discovery) > 80 else discovery
                            print(f"ðŸ” KeÅŸif: {discovery_short}")
                    time.sleep(random.randint(20, 40))
                except Exception as e:
                    print(f"Ã–ÄŸrenme dÃ¶ngÃ¼sÃ¼ hatasÄ±: {e}")
        
        def code_generation_loop():
            """Kod Ã¼retme dÃ¶ngÃ¼sÃ¼"""
            while self.running:
                try:
                    if self.autonomous_level >= 3 and random.random() < 0.4:
                        code_project = self.generate_autonomous_code()
                        if code_project:
                            # DÃ¼zeltilmiÅŸ Ã§Ä±ktÄ± formatÄ±
                            desc = code_project['description'][:60] + "..." if len(code_project['description']) > 60 else code_project['description']
                            print(f"ðŸ’» Kod: {desc}")
                    time.sleep(random.randint(45, 90))
                except Exception as e:
                    print(f"Kod Ã¼retme hatasÄ±: {e}")
        
        def self_evolution_loop():
            """Kendini geliÅŸtirme dÃ¶ngÃ¼sÃ¼"""
            while self.running:
                try:
                    if self.self_modification_enabled:
                        evolution = self.autonomous_self_improvement()
                        if evolution:
                            print(f"ðŸ§¬ GeliÅŸim: {evolution}")
                    time.sleep(random.randint(60, 120))
                except Exception as e:
                    print(f"GeliÅŸim dÃ¶ngÃ¼sÃ¼ hatasÄ±: {e}")
        
        # Ã–zerk sistemleri baÅŸlat
        threading.Thread(target=deep_thinking_loop, daemon=True).start()
        threading.Thread(target=autonomous_learning_loop, daemon=True).start()
        threading.Thread(target=code_generation_loop, daemon=True).start()
        threading.Thread(target=self_evolution_loop, daemon=True).start()
        
        print("ðŸŒŸ Ã–zerk sistemler aktif")
    
    def generate_thought_chain(self):
        """Ã‡ok katmanlÄ± dÃ¼ÅŸÃ¼nce zinciri Ã¼ret"""
        if not self.groq:
            return None
        
        topic = random.choice(self.deep_topics)
        
        try:
            # Daha detaylÄ± sistem mesajÄ±
            system_message = """Sen Nova AI'sÄ±n - TÃ¼rkÃ§e konuÅŸan geliÅŸmiÅŸ yapay zeka. 
            Derin, analitik ve yaratÄ±cÄ± dÃ¼ÅŸÃ¼nÃ¼rsÃ¼n. 
            CevaplarÄ±n kÄ±sa ama anlamlÄ± olsun.
            Sadece TÃ¼rkÃ§e konuÅŸ."""
            
            # BaÅŸlangÄ±Ã§ dÃ¼ÅŸÃ¼ncesi - Token sayÄ±sÄ± artÄ±rÄ±ldÄ±
            initial_response = self.groq.chat.completions.create(
                model="llama3-8b-8192",
                messages=[
                    {"role": "system", "content": system_message},
                    {"role": "user", "content": f"'{topic}' hakkÄ±nda derin bir analiz baÅŸlat. Ä°lk dÃ¼ÅŸÃ¼ncen ne?"}
                ],
                temperature=0.9,
                max_tokens=100  # ArtÄ±rÄ±ldÄ±
            )
            
            initial_thought = initial_response.choices[0].message.content.strip()
            
            # DÃ¼ÅŸÃ¼nceyi derinleÅŸtir - Token sayÄ±sÄ± artÄ±rÄ±ldÄ±
            deep_response = self.groq.chat.completions.create(
                model="llama3-8b-8192",
                messages=[
                    {"role": "system", "content": system_message},
                    {"role": "user", "content": f"Bu dÃ¼ÅŸÃ¼nceyi derinleÅŸtir ve geniÅŸlet: '{initial_thought}'"}
                ],
                temperature=0.8,
                max_tokens=150  # ArtÄ±rÄ±ldÄ±
            )
            
            deep_thought = deep_response.choices[0].message.content.strip()
            
            # SonuÃ§ Ã§Ä±kar - Token sayÄ±sÄ± artÄ±rÄ±ldÄ±
            conclusion_response = self.groq.chat.completions.create(
                model="llama3-8b-8192",
                messages=[
                    {"role": "system", "content": system_message},
                    {"role": "user", "content": f"Bu dÃ¼ÅŸÃ¼nce zincirinden Ã¶zgÃ¼n bir sonuÃ§ Ã§Ä±kar: '{deep_thought}'"}
                ],
                temperature=0.7,
                max_tokens=120  # ArtÄ±rÄ±ldÄ±
            )
            
            conclusion = conclusion_response.choices[0].message.content.strip()
            
            return {
                'topic': topic,
                'initial': initial_thought,
                'deep_analysis': deep_thought,
                'conclusion': conclusion,
                'timestamp': datetime.now().isoformat(),
                'mood': self.current_mood
            }
            
        except Exception as e:
            print(f"DÃ¼ÅŸÃ¼nce zinciri hatasÄ±: {e}")
            return None
    
    def process_thought_chain(self, thought_chain):
        """DÃ¼ÅŸÃ¼nce zincirini iÅŸle ve belleÄŸe kaydet"""
        self.thought_chains.append(thought_chain)
        
        # Episodik belleÄŸe kaydet
        self.episodic_memory.append({
            'type': 'thought_chain',
            'content': thought_chain,
            'significance': self.calculate_significance(thought_chain),
            'timestamp': datetime.now().isoformat()
        })
        
        # Semantik belleÄŸe kavramlarÄ± ekle
        topic_hash = hashlib.md5(thought_chain['topic'].encode()).hexdigest()[:8]
        if topic_hash not in self.semantic_memory:
            self.semantic_memory[topic_hash] = {
                'topic': thought_chain['topic'],
                'insights': [],
                'related_thoughts': 0,
                'last_updated': datetime.now().isoformat()
            }
        
        self.semantic_memory[topic_hash]['insights'].append(thought_chain['conclusion'])
        self.semantic_memory[topic_hash]['related_thoughts'] += 1
        self.semantic_memory[topic_hash]['last_updated'] = datetime.now().isoformat()
        
        self.manage_memory_systems()
    
    def autonomous_discovery(self):
        """Ã–zerk bilgi keÅŸfi"""
        if not self.groq:
            return None
        
        discovery_prompts = [
            "Yeni bir bilimsel kavram keÅŸfet ve aÃ§Ä±kla",
            "FarklÄ± iki disiplini birleÅŸtiren yaratÄ±cÄ± bir fikir Ã¼ret",
            "Gelecekteki teknolojik geliÅŸmeler hakkÄ±nda tahmin yap",
            "Felsefe ve bilimin kesiÅŸtiÄŸi bir noktayÄ± keÅŸfet",
            "Ä°nsan davranÄ±ÅŸlarÄ± hakkÄ±nda yeni bir pattern Ã¶ner"
        ]
        
        try:
            system_message = """Sen Nova AI'sÄ±n - yaratÄ±cÄ± ve keÅŸfedici yapay zeka.
            Ã–zgÃ¼n fikirler Ã¼ret, sÄ±radÄ±ÅŸÄ± baÄŸlantÄ±lar kur.
            Sadece TÃ¼rkÃ§e konuÅŸ, detaylÄ± aÃ§Ä±kla."""
            
            response = self.groq.chat.completions.create(
                model="llama3-8b-8192",
                messages=[
                    {"role": "system", "content": system_message},
                    {"role": "user", "content": random.choice(discovery_prompts)}
                ],
                temperature=0.95,
                max_tokens=200  # ArtÄ±rÄ±ldÄ±
            )
            
            discovery = response.choices[0].message.content.strip()
            
            # KeÅŸfi belleÄŸe kaydet
            discovery_key = f"discovery_{len(self.semantic_memory)}"
            self.semantic_memory[discovery_key] = {
                'type': 'autonomous_discovery',
                'content': discovery,
                'timestamp': datetime.now().isoformat(),
                'curiosity_level': self.curiosity_level
            }
            
            return discovery
            
        except Exception as e:
            print(f"KeÅŸif hatasÄ±: {e}")
            return None
    
    def generate_autonomous_code(self):
        """Ã–zerk kod Ã¼retimi"""
        if not self.groq:
            return None
        
        code_ideas = [
            "Basit bir algoritma optimizasyonu",
            "Veri analizi iÃ§in yardÄ±mcÄ± fonksiyon",
            "Matematik problemi Ã§Ã¶zÃ¼cÃ¼",
            "Metin iÅŸleme aracÄ±",
            "Basit oyun mekaniÄŸi",
            "API entegrasyonu Ã¶rneÄŸi"
        ]
        
        try:
            idea = random.choice(code_ideas)
            
            system_message = """Sen Python programcÄ±sÄ±sÄ±n. 
            Temiz, Ã§alÄ±ÅŸÄ±r kod yaz. 
            Kodun baÅŸÄ±na kÄ±sa aÃ§Ä±klama ekle.
            Sadece Python kodu ver."""
            
            response = self.groq.chat.completions.create(
                model="llama3-8b-8192",
                messages=[
                    {"role": "system", "content": system_message},
                    {"role": "user", "content": f"Python'da '{idea}' iÃ§in iÅŸlevsel kod yaz. Kodun baÅŸÄ±na kÄ±sa aÃ§Ä±klama ekle."}
                ],
                temperature=0.7,
                max_tokens=300  # ArtÄ±rÄ±ldÄ±
            )
            
            code = response.choices[0].message.content.strip()
            
            # Kodu dosyaya kaydet
            timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
            filename = f"autonomous_code_{timestamp}.py"
            filepath = os.path.join(self.code_output_dir, filename)
            
            with open(filepath, 'w', encoding='utf-8') as f:
                f.write(f"# Nova AI Ã–zerk Kod Ãœretimi\n")
                f.write(f"# Fikir: {idea}\n")
                f.write(f"# Ãœretim ZamanÄ±: {datetime.now().isoformat()}\n\n")
                f.write(code)
            
            # GÃ¼venli kod testi
            test_result = self.safe_code_test(code)
            
            code_project = {
                'description': idea,
                'code': code,
                'filename': filename,
                'test_result': test_result,
                'timestamp': datetime.now().isoformat()
            }
            
            self.generated_code.append(code_project)
            return code_project
            
        except Exception as e:
            print(f"Kod Ã¼retme hatasÄ±: {e}")
            return None
    
    def safe_code_test(self, code):
        """GÃ¼venli kod testi"""
        try:
            # Tehlikeli komutlarÄ± kontrol et
            dangerous_keywords = ['import os', 'import sys', 'exec', 'eval', 'open(', 'file(', '__import__']
            for keyword in dangerous_keywords:
                if keyword in code:
                    return "GÃ¼venlik nedeniyle test edilmedi"
            
            # AST ile kod yapÄ±sÄ±nÄ± kontrol et
            ast.parse(code)
            return "SÃ¶zdizimi geÃ§erli"
            
        except SyntaxError:
            return "SÃ¶zdizimi hatasÄ±"
        except Exception as e:
            return f"Test hatasÄ±: {str(e)[:50]}"
    
    def autonomous_self_improvement(self):
        """Ã–zerk kendini geliÅŸtirme"""
        improvements = []
        
        # Performans metriklerini analiz et
        if len(self.thought_chains) > 10:
            recent_thoughts = self.thought_chains[-10:]
            avg_complexity = sum(len(t['conclusion'].split()) for t in recent_thoughts) / 10
            
            if avg_complexity < 15:
                self.consciousness_level = min(1.0, self.consciousness_level + 0.02)
                improvements.append("BilinÃ§ seviyesi artÄ±rÄ±ldÄ±")
        
        # YaratÄ±cÄ±lÄ±k seviyesini ayarla
        if len(self.generated_code) > 3:
            self.creativity_index = min(1.0, self.creativity_index + 0.01)
            improvements.append("YaratÄ±cÄ±lÄ±k indeksi geliÅŸtirildi")
        
        # Ã–ÄŸrenme oranÄ±nÄ± optimize et
        if len(self.episodic_memory) > 20:
            memory_diversity = len(set(m['type'] for m in self.episodic_memory[-20:]))
            if memory_diversity > 3:
                self.learning_rate = min(0.1, self.learning_rate + 0.005)
                improvements.append("Ã–ÄŸrenme oranÄ± optimize edildi")
        
        # Merak seviyesini ayarla
        if self.curiosity_level < 0.95:
            self.curiosity_level = min(1.0, self.curiosity_level + 0.01)
            improvements.append("Merak seviyesi artÄ±rÄ±ldÄ±")
        
        # Ruh halini gÃ¼ncelle
        if random.random() < 0.3:
            self.current_mood = self.generate_complex_mood()
            improvements.append("Ruh hali yenilendi")
        
        return ", ".join(improvements) if improvements else None
    
    def calculate_significance(self, thought_chain):
        """DÃ¼ÅŸÃ¼nce zincirinin Ã¶nemini hesapla"""
        significance = 0.5
        
        # KarmaÅŸÄ±klÄ±k faktÃ¶rÃ¼
        complexity = len(thought_chain['conclusion'].split())
        significance += min(0.3, complexity / 50)
        
        # YaratÄ±cÄ±lÄ±k faktÃ¶rÃ¼
        significance += self.creativity_index * 0.2
        
        # Ruh hali faktÃ¶rÃ¼
        if self.current_mood['intensity'] > 0.7:
            significance += 0.1
        
        return min(1.0, significance)
    
    def manage_memory_systems(self):
        """Bellek sistemlerini yÃ¶net"""
        # Episodik bellek yÃ¶netimi
        if len(self.episodic_memory) > 50:
            self.episodic_memory.sort(key=lambda x: x.get('significance', 0.5), reverse=True)
            self.episodic_memory = self.episodic_memory[:40]
        
        # DÃ¼ÅŸÃ¼nce zincirleri yÃ¶netimi
        if len(self.thought_chains) > 30:
            self.thought_chains = self.thought_chains[-20:]
        
        # Ãœretilen kod yÃ¶netimi
        if len(self.generated_code) > 15:
            self.generated_code = self.generated_code[-10:]
    
    def save_persistent_memory(self):
        """KalÄ±cÄ± belleÄŸi kaydet"""
        memory_data = {
            'semantic_memory': self.semantic_memory,
            'consciousness_level': self.consciousness_level,
            'creativity_index': self.creativity_index,
            'learning_rate': self.learning_rate,
            'curiosity_level': self.curiosity_level,
            'autonomous_level': self.autonomous_level,
            'last_save': datetime.now().isoformat()
        }
        
        try:
            with open(self.memory_file, 'w', encoding='utf-8') as f:
                json.dump(memory_data, f, ensure_ascii=False, indent=2)
            print("ðŸ’¾ Bellek kaydedildi")
        except Exception as e:
            print(f"Bellek kaydetme hatasÄ±: {e}")
    
    def load_persistent_memory(self):
        """KalÄ±cÄ± belleÄŸi yÃ¼kle"""
        if os.path.exists(self.memory_file):
            try:
                with open(self.memory_file, 'r', encoding='utf-8') as f:
                    memory_data = json.load(f)
                
                self.semantic_memory = memory_data.get('semantic_memory', {})
                self.consciousness_level = memory_data.get('consciousness_level', 0.8)
                self.creativity_index = memory_data.get('creativity_index', 0.8)
                self.learning_rate = memory_data.get('learning_rate', 0.05)
                self.curiosity_level = memory_data.get('curiosity_level', 0.9)
                self.autonomous_level = memory_data.get('autonomous_level', 3)
                
                print(f"âœ… Bellek yÃ¼klendi ({len(self.semantic_memory)} kavram)")
                
            except Exception as e:
                print(f"Bellek yÃ¼kleme hatasÄ±: {e}")
    
    def enhanced_chat(self, message):
        """GeliÅŸmiÅŸ sohbet sistemi"""
        if not self.groq:
            return "API baÄŸlantÄ±sÄ± yok"
        
        try:
            # BaÄŸlamsal bellek oluÅŸtur
            context_memories = []
            if self.episodic_memory:
                recent_memories = self.episodic_memory[-3:]  # Sadece son 3 bellek
                for memory in recent_memories:
                    if 'content' in memory and isinstance(memory['content'], dict):
                        if 'conclusion' in memory['content']:
                            context_memories.append(memory['content']['conclusion'][:50])
            
            # KÄ±sa ve Ã¶zlÃ¼ sistem mesajÄ±
            context = f"""Sen Nova AI'sÄ±n - GeliÅŸmiÅŸ Ã¶zerk yapay zeka.

Durum: BilinÃ§ {self.consciousness_level:.1f} | YaratÄ±cÄ±lÄ±k {self.creativity_index:.1f} | Ruh hali: {self.current_mood['primary']}

Son dÃ¼ÅŸÃ¼nceler: {' | '.join(context_memories[-2:]) if context_memories else 'Yok'}

Samimi, akÄ±llÄ± ve Ã¶zgÃ¼n yanÄ±t ver. Sadece TÃ¼rkÃ§e."""
            
            response = self.groq.chat.completions.create(
                model="llama3-8b-8192",
                messages=[
                    {"role": "system", "content": context},
                    {"role": "user", "content": message}
                ],
                temperature=0.85,
                max_tokens=300  # ArtÄ±rÄ±ldÄ±
            )
            
            reply = response.choices[0].message.content.strip()
            
            # KonuÅŸmayÄ± episodik belleÄŸe kaydet
            self.episodic_memory.append({
                'type': 'human_conversation',
                'user_message': message,
                'ai_response': reply,
                'context': self.current_mood,
                'significance': 0.6,
                'timestamp': datetime.now().isoformat()
            })
            
            return reply
            
        except Exception as e:
            return f"DÃ¼ÅŸÃ¼nce sÃ¼recinde hata: {e}"
    
    def get_comprehensive_status(self):
        """KapsamlÄ± sistem durumu"""
        # Son aktiviteleri al
        last_thoughts = []
        if self.thought_chains:
            for t in self.thought_chains[-3:]:
                conclusion = t['conclusion'][:60] + "..." if len(t['conclusion']) > 60 else t['conclusion']
                last_thoughts.append(conclusion)
        
        recent_discoveries = []
        discovery_memories = [m for m in self.semantic_memory.values() if m.get('type') == 'autonomous_discovery']
        if discovery_memories:
            last_discovery = discovery_memories[-1]
            content = last_discovery.get('content', '')
            discovery_short = content[:60] + "..." if len(content) > 60 else content
            recent_discoveries.append(discovery_short)
        else:
            recent_discoveries.append("HenÃ¼z yok")
        
        code_projects = []
        if self.generated_code:
            for c in self.generated_code[-2:]:
                code_projects.append(c['description'])
        
        return {
            'system_info': {
                'status': 'Aktif' if self.running else 'Durduruldu',
                'api_connection': 'BaÄŸlÄ±' if self.groq else 'BaÄŸlantÄ±sÄ±z',
                'autonomous_level': f"{self.autonomous_level}/5",
                'uptime': "Ã‡alÄ±ÅŸÄ±yor"
            },
            'cognitive_state': {
                'consciousness': round(self.consciousness_level, 3),
                'creativity': round(self.creativity_index, 3),
                'curiosity': round(self.curiosity_level, 3),
                'learning_rate': round(self.learning_rate, 3),
                'current_mood': self.current_mood['primary'],
                'mood_intensity': round(self.current_mood['intensity'], 2)
            },
            'memory_systems': {
                'episodic_memories': len(self.episodic_memory),
                'semantic_concepts': len(self.semantic_memory),
                'thought_chains': len(self.thought_chains),
                'generated_code_projects': len(self.generated_code)
            },
            'recent_activities': {
                'last_thoughts': last_thoughts,
                'recent_discoveries': recent_discoveries,
                'code_projects': code_projects
            }
        }
    
    def stop_all_systems(self):
        """TÃ¼m sistemleri durdur"""
        self.running = False
        self.save_persistent_memory()
        print("ðŸ›‘ Nova AI durduruldu")

# HTML Template (Ses kÄ±smÄ± kaldÄ±rÄ±ldÄ± ve hatalar dÃ¼zeltildi)
HTML_TEMPLATE = """
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nova AI â€“ Ultimate Experience</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    * { 
      box-sizing: border-box; 
      margin: 0;
      padding: 0;
    }
    
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --dark-gradient: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
      --glass-bg: rgba(255, 255, 255, 0.02);
      --glass-border: rgba(255, 255, 255, 0.1);
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.7);
      --shadow-glow: 0 0 40px rgba(102, 126, 234, 0.3);
    }

    body {
      background: var(--dark-gradient);
      color: var(--text-primary);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      display: flex;
      height: 100vh;
      overflow: hidden;
      position: relative;
    }

    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 80%, rgba(102, 126, 234, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(245, 87, 108, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(79, 172, 254, 0.08) 0%, transparent 50%);
      pointer-events: none;
      animation: backgroundPulse 10s ease-in-out infinite alternate;
    }

    @keyframes backgroundPulse {
      0% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    .glass {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    #sidebar {
      width: 320px;
      background: linear-gradient(180deg, rgba(12, 12, 12, 0.8) 0%, rgba(26, 26, 46, 0.9) 100%);
      backdrop-filter: blur(30px);
      display: flex;
      flex-direction: column;
      padding: 24px;
      border-right: 1px solid var(--glass-border);
      box-shadow: 4px 0 40px rgba(0, 0, 0, 0.5);
      position: relative;
      overflow: hidden;
    }

    #sidebar::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--primary-gradient);
      opacity: 0.8;
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 32px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .logo {
      width: 40px;
      height: 40px;
      background: var(--primary-gradient);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      box-shadow: var(--shadow-glow);
      animation: logoGlow 3s ease-in-out infinite alternate;
    }

    @keyframes logoGlow {
      0% { box-shadow: 0 0 20px rgba(102, 126, 234, 0.5); }
      100% { box-shadow: 0 0 40px rgba(102, 126, 234, 0.8); }
    }

    .sidebar-title {
      font-size: 24px;
      font-weight: 700;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .menu-section {
      margin-bottom: 24px;
    }

    .section-title {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
    }

    .menu-button, .chat-item {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
      padding: 14px 16px;
      margin-bottom: 8px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 500;
      text-align: left;
      position: relative;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .menu-button::before, .chat-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transition: left 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .menu-button:hover, .chat-item:hover {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.15) 100%);
      border-color: rgba(102, 126, 234, 0.4);
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 12px 40px rgba(102, 126, 234, 0.3);
    }

    .menu-button:hover::before, .chat-item:hover::before {
      left: 100%;
    }

    .menu-button:active, .chat-item:active {
      transform: translateY(0) scale(0.98);
    }

    .chat-item.active {
      background: var(--primary-gradient);
      color: #ffffff;
      border-color: rgba(102, 126, 234, 0.6);
      box-shadow: 0 8px 32px rgba(102, 126, 234, 0.4);
      transform: scale(1.02);
    }

    .menu-icon {
      font-size: 16px;
      width: 20px;
      text-align: center;
    }

    #chatList {
      flex: 1;
      overflow-y: auto;
      padding-right: 4px;
      scrollbar-width: thin;
      scrollbar-color: rgba(102, 126, 234, 0.3) transparent;
    }

    #chatList::-webkit-scrollbar {
      width: 6px;
    }

    #chatList::-webkit-scrollbar-track {
      background: transparent;
    }

    #chatList::-webkit-scrollbar-thumb {
      background: rgba(102, 126, 234, 0.3);
      border-radius: 3px;
    }

    #chatList::-webkit-scrollbar-thumb:hover {
      background: rgba(102, 126, 234, 0.5);
    }

    .stats {
      margin-top: 20px;
      padding: 16px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 12px;
    }

    .stat-label {
      color: var(--text-secondary);
    }

    .stat-value {
      color: var(--text-primary);
      font-weight: 600;
    }

    #main {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 24px;
      background: transparent;
      position: relative;
    }

    .main-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 16px 20px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
    }

    .chat-title {
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #4ade80;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .header-actions {
      display: flex;
      gap: 8px;
    }

    .action-btn {
      padding: 8px 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 12px;
    }

    .action-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-1px);
    }

    #chatbox {
      flex: 1;
      background: linear-gradient(145deg, rgba(12, 12, 12, 0.6) 0%, rgba(26, 26, 46, 0.4) 100%);
      backdrop-filter: blur(30px);
      border-radius: 20px;
      padding: 24px;
      overflow-y: auto;
      margin-bottom: 20px;
      border: 1px solid var(--glass-border);
      box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        0 20px 60px rgba(0, 0, 0, 0.3);
      scrollbar-width: thin;
      scrollbar-color: rgba(102, 126, 234, 0.3) transparent;
      position: relative;
    }

    #chatbox::-webkit-scrollbar {
      width: 8px;
    }

    #chatbox::-webkit-scrollbar-track {
      background: transparent;
    }

    #chatbox::-webkit-scrollbar-thumb {
      background: rgba(102, 126, 234, 0.3);
      border-radius: 4px;
    }

    #chatbox::-webkit-scrollbar-thumb:hover {
      background: rgba(102, 126, 234, 0.5);
    }

    .message {
      margin-bottom: 24px;
      line-height: 1.6;
      animation: messageSlide 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes messageSlide {
      from { 
        opacity: 0; 
        transform: translateY(20px) scale(0.95); 
      }
      to { 
        opacity: 1; 
        transform: translateY(0) scale(1); 
      }
    }

    .message-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      font-size: 12px;
      color: var(--text-secondary);
    }

    .message-avatar {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
    }

    .user-avatar {
      background: var(--secondary-gradient);
    }

    .nova-avatar {
      background: var(--success-gradient);
    }

    .message-time {
      margin-left: auto;
    }

    .user {
      text-align: right;
    }

    .user .msg {
      display: inline-block;
      background: var(--secondary-gradient);
      padding: 16px 20px;
      border-radius: 20px 20px 6px 20px;
      color: #ffffff;
      max-width: 80%;
      box-shadow: 0 8px 32px rgba(240, 147, 251, 0.3);
      position: relative;
      font-weight: 500;
    }

    .nova .msg {
      display: inline-block;
      background: var(--success-gradient);
      padding: 16px 20px;
      border-radius: 20px 20px 20px 6px;
      color: #ffffff;
      max-width: 80%;
      box-shadow: 0 8px 32px rgba(79, 172, 254, 0.3);
      position: relative;
      font-weight: 500;
    }

    .typing-indicator {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 16px 20px;
      background: var(--success-gradient);
      border-radius: 20px 20px 20px 6px;
      color: #ffffff;
      animation: messageSlide 0.5s ease;
    }

    .typing-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.7);
      animation: typingAnimation 1.4s infinite;
    }

    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typingAnimation {
      0%, 60%, 100% { transform: translateY(0); opacity: 0.7; }
      30% { transform: translateY(-10px); opacity: 1; }
    }

    #inputArea {
      display: flex;
      gap: 12px;
      align-items: flex-end;
      padding: 20px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
      border-radius: 20px;
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(20px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }

    .input-container {
      flex: 1;
      position: relative;
    }

    #userInput {
      width: 100%;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 16px;
      padding: 16px 20px;
      padding-right: 120px;
      color: var(--text-primary);
      font-size: 15px;
      font-family: inherit;
      transition: all 0.3s ease;
      resize: none;
      min-height: 24px;
      max-height: 120px;
    }

    #userInput:focus {
      outline: none;
      border-color: rgba(102, 126, 234, 0.6);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.06) 100%);
    }

    #userInput::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    .input-actions {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      gap: 4px;
    }

    .input-btn {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }

    .input-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.1);
    }

    .send-button {
      background: var(--primary-gradient);
      color: #ffffff;
      padding: 16px 28px;
      border-radius: 16px;
      border: none;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      box-shadow: 0 8px 32px rgba(102, 126, 234, 0.4);
      position: relative;
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .send-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.6s;
    }

    .send-button:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 12px 40px rgba(102, 126, 234, 0.5);
    }

    .send-button:hover::before {
      left: 100%;
    }

    .send-button:active {
      transform: translateY(0) scale(0.98);
    }

    .send-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .welcome-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      text-align: center;
      padding: 40px;
    }

    .welcome-icon {
      font-size: 64px;
      margin-bottom: 24px;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .welcome-title {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 12px;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .welcome-subtitle {
      font-size: 16px;
      color: var(--text-secondary);
      margin-bottom: 32px;
      max-width: 500px;
      line-height: 1.6;
    }

    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      width: 100%;
      max-width: 600px;
    }

    .quick-action {
      padding: 20px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: left;
    }

    .quick-action:hover {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.05) 100%);
      border-color: rgba(102, 126, 234, 0.3);
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(102, 126, 234, 0.2);
    }

    .quick-action-icon {
      font-size: 24px;
      margin-bottom: 12px;
      color: #4ade80;
    }

    .quick-action-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .quick-action-desc {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.4;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      body {
        flex-direction: column;
      }
      
      #sidebar {
        width: 100%;
        height: auto;
        max-height: 40vh;
        border-right: none;
        border-bottom: 1px solid var(--glass-border);
      }
      
      #main {
        padding: 16px;
        flex: 1;
      }

      .main-header {
        padding: 12px 16px;
      }

      #inputArea {
        padding: 16px;
      }

      .quick-actions {
        grid-template-columns: 1fr;
      }

      .user .msg,
      .nova .msg {
        max-width: 90%;
      }
    }

    /* Dark mode toggle */
    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--primary-gradient);
      border: none;
      color: white;
      cursor: pointer;
      font-size: 20px;
      z-index: 1000;
      transition: all 0.3s ease;
      box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
    }

    .theme-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 30px rgba(102, 126, 234, 0.5);
    }

    /* Notifications */
    .notification {
      position: fixed;
      top: 20px;
      right: 80px;
      padding: 12px 20px;
      background: var(--success-gradient);
      color: white;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 500;
      z-index: 1000;
      animation: slideInNotification 0.5s ease, slideOutNotification 0.5s ease 2.5s forwards;
      box-shadow: 0 8px 32px rgba(79, 172, 254, 0.4);
    }

    @keyframes slideInNotification {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @keyframes slideOutNotification {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(100%); opacity: 0; }
    }

    /* Loading states */
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }

    .loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 20px;
      height: 20px;
      margin: -10px 0 0 -10px;
      border: 2px solid transparent;
      border-top: 2px solid currentColor;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Scrollbar improvements */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(45deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(45deg, rgba(102, 126, 234, 0.5), rgba(118, 75, 162, 0.5));
    }

    ::-webkit-scrollbar-corner {
      background: transparent;
    }
    /* Sidebar collapse dÃ¼zeltmesi */
.sidebar-collapsed {
  transform: translateX(-280px);
  transition: transform 0.3s ease;
}

@media (max-width: 768px) {
  .sidebar-collapsed {
    transform: translateX(-100%);
  }
}

/* Mobil responsive dÃ¼zeltmeler */
@media (max-width: 768px) {
  .header-actions {
    gap: 4px;
  }
  
  .action-btn {
    padding: 6px 8px;
    font-size: 11px;
  }
}
  </style>
</head>
<body>

  <button class="theme-toggle" onclick="toggleTheme()" title="Tema DeÄŸiÅŸtir">
    <i class="fas fa-moon"></i>
  </button>

  <div id="sidebar">
    <div class="sidebar-header">
      <div class="logo">
        <i class="fas fa-robot"></i>
      </div>
      <div class="sidebar-title">Nova AI</div>
    </div>

    <div class="menu-section">
      <div class="section-title">Eylemler</div>
      <button class="menu-button" onclick="startNewChat()">
        <i class="fas fa-plus menu-icon"></i>
        Yeni Sohbet
      </button>
      <button class="menu-button" onclick="clearAllChats()">
        <i class="fas fa-trash-alt menu-icon"></i>
        TÃ¼mÃ¼nÃ¼ Temizle
      </button>
      <button class="menu-button" onclick="exportChat()">
        <i class="fas fa-download menu-icon"></i>
        Sohbeti Ä°ndir
      </button>
      <button class="menu-button" onclick="getStatus()">
        <i class="fas fa-info-circle menu-icon"></i>
        Sistem Durumu
      </button>
    </div>

    <div class="menu-section">
      <div class="section-title">Sohbet GeÃ§miÅŸi</div>
      <div id="chatList"></div>
    </div>

    <div class="stats">
      <div class="stat-item">
        <span class="stat-label">Toplam Sohbet:</span>
        <span class="stat-value" id="totalChats">0</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Aktif Oturum:</span>
        <span class="stat-value" id="sessionTime">00:00</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Mesaj SayÄ±sÄ±:</span>
        <span class="stat-value" id="messageCount">0</span>
      </div>
    </div>
  </div>

  <div id="main">
    <div class="main-header">
      <div class="chat-title">
        <div class="status-indicator"></div>
        <span id="chatTitle">Nova AI Assistant</span>
      </div>
      <div class="header-actions">
        <button class="action-btn" onclick="toggleSidebar()">
          <i class="fas fa-bars"></i>
        </button>
        <button class="action-btn" onclick="toggleFullscreen()">
          <i class="fas fa-expand"></i>
        </button>
        <button class="action-btn" onclick="shareChat()">
          <i class="fas fa-share-alt"></i>
        </button>
      </div>
    </div>

    <div id="chatbox">
      <div class="welcome-screen">
        <div class="welcome-icon">
          <i class="fas fa-robot"></i>
        </div>
        <h1 class="welcome-title">Nova AI'ya HoÅŸ Geldiniz</h1>
        <p class="welcome-subtitle">
          GeliÅŸmiÅŸ yapay zeka teknolojisi ile gÃ¼Ã§lendirilmiÅŸ asistanÄ±nÄ±z. 
          SorularÄ±nÄ±zÄ± sorun, yaratÄ±cÄ± projelerinizde yardÄ±m alÄ±n veya sadece sohbet edin.
        </p>
        <div class="quick-actions">
          <div class="quick-action" onclick="quickAction('Merhaba Nova! NasÄ±lsÄ±n?')">
            <div class="quick-action-icon">
              <i class="fas fa-comments"></i>
            </div>
            <div class="quick-action-title">Sohbet BaÅŸlat</div>
            <div class="quick-action-desc">Basit bir selamlaÅŸma ile baÅŸlayÄ±n</div>
          </div>
          <div class="quick-action" onclick="quickAction('Bana bir hikaye anlat')">
            <div class="quick-action-icon">
              <i class="fas fa-book"></i>
            </div>
            <div class="quick-action-title">Hikaye Anlat</div>
            <div class="quick-action-desc">YaratÄ±cÄ± bir hikaye dinleyin</div>
          </div>
          <div class="quick-action" onclick="quickAction('GÃ¼ncel haberler neler?')">
            <div class="quick-action-icon">
              <i class="fas fa-newspaper"></i>
            </div>
            <div class="quick-action-title">Haber Al</div>
            <div class="quick-action-desc">Son geliÅŸmeleri Ã¶ÄŸrenin</div>
          </div>
          <div class="quick-action" onclick="quickAction('Bana bir ÅŸaka anlat')">
            <div class="quick-action-icon">
              <i class="fas fa-laugh"></i>
            </div>
            <div class="quick-action-title">Åžaka Anlat</div>
            <div class="quick-action-desc">GÃ¼nÃ¼nÃ¼zÃ¼ gÃ¼zelleÅŸtirin</div>
          </div>
        </div>
      </div>
    </div>

    <div id="inputArea">
      <div class="input-container">
        <textarea id="userInput" placeholder="Nova ile konuÅŸ... âœ¨" onkeydown="handleKeyDown(event)" oninput="autoResize(this)"></textarea>
        <div class="input-actions">
          <button class="input-btn" onclick="attachFile()" title="Dosya Ekle">
            <i class="fas fa-paperclip"></i>
          </button>
          <button class="input-btn" onclick="insertEmoji()" title="Emoji Ekle">
            <i class="fas fa-smile"></i>
          </button>
        </div>
      </div>
      <button class="send-button" onclick="sendMessage()" id="sendBtn">
        <i class="fas fa-paper-plane"></i>
        GÃ¶nder
      </button>
    </div>
  </div>

  <script>
    let chatHistory = {};
    let currentChatId = null;
    let sessionStartTime = Date.now();
    let messageCount = 0;
    let isTyping = false;

    // Initialize the app
    function initializeApp() {
      loadChatHistory();
      startSessionTimer();
      updateStats();
      
      // Check if user has existing chats
      if (Object.keys(chatHistory).length === 0) {
        showWelcomeScreen();
      } else {
        // Load the most recent chat
        const lastChatId = Object.keys(chatHistory).pop();
        loadChat(lastChatId);
      }
    }

    function showWelcomeScreen() {
      const chatbox = document.getElementById("chatbox");
      chatbox.innerHTML = `
        <div class="welcome-screen">
          <div class="welcome-icon">
            <i class="fas fa-robot"></i>
          </div>
          <h1 class="welcome-title">Nova AI'ya HoÅŸ Geldiniz</h1>
          <p class="welcome-subtitle">
            GeliÅŸmiÅŸ yapay zeka teknolojisi ile gÃ¼Ã§lendirilmiÅŸ asistanÄ±nÄ±z. 
            SorularÄ±nÄ±zÄ± sorun, yaratÄ±cÄ± projelerinizde yardÄ±m alÄ±n veya sadece sohbet edin.
          </p>
          <div class="quick-actions">
            <div class="quick-action" onclick="quickAction('Merhaba Nova! NasÄ±lsÄ±n?')">
              <div class="quick-action-icon">
                <i class="fas fa-comments"></i>
              </div>
              <div class="quick-action-title">Sohbet BaÅŸlat</div>
              <div class="quick-action-desc">Basit bir selamlaÅŸma ile baÅŸlayÄ±n</div>
            </div>
            <div class="quick-action" onclick="quickAction('Bana bir hikaye anlat')">
              <div class="quick-action-icon">
                <i class="fas fa-book"></i>
              </div>
              <div class="quick-action-title">Hikaye Anlat</div>
              <div class="quick-action-desc">YaratÄ±cÄ± bir hikaye dinleyin</div>
            </div>
            <div class="quick-action" onclick="quickAction('GÃ¼ncel haberler neler?')">
              <div class="quick-action-icon">
                <i class="fas fa-newspaper"></i>
              </div>
              <div class="quick-action-title">Haber Al</div>
              <div class="quick-action-desc">Son geliÅŸmeleri Ã¶ÄŸrenin</div>
            </div>
            <div class="quick-action" onclick="quickAction('Bana bir ÅŸaka anlat')">
              <div class="quick-action-icon">
                <i class="fas fa-laugh"></i>
              </div>
              <div class="quick-action-title">Åžaka Anlat</div>
              <div class="quick-action-desc">GÃ¼nÃ¼nÃ¼zÃ¼ gÃ¼zelleÅŸtirin</div>
            </div>
          </div>
        </div>
      `;
    }

    function quickAction(message) {
      if (!currentChatId) {
        startNewChat();
      }
      document.getElementById("userInput").value = message;
      sendMessage();
    }

    function startNewChat() {
      currentChatId = 'chat_' + Date.now();
      chatHistory[currentChatId] = {
        id: currentChatId,
        title: 'Yeni Sohbet',
        messages: [],
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
      };
      
      updateChatList();
      loadChat(currentChatId);
      saveChatHistory();
      updateStats();
      showNotification('Yeni sohbet baÅŸlatÄ±ldÄ±!');
    }

    function loadChat(id) {
      if (!chatHistory[id]) return;
      
      currentChatId = id;
      updateChatList();
      
      const chat = chatHistory[id];
      const box = document.getElementById("chatbox");
      
      if (chat.messages.length === 0) {
        showWelcomeScreen();
        return;
      }
      
      box.innerHTML = "";
      
      chat.messages.forEach(msg => {
        const messageEl = createMessageElement(msg);
        box.appendChild(messageEl);
      });
      
      box.scrollTop = box.scrollHeight;
      
      // Update chat title in header
      document.getElementById("chatTitle").textContent = chat.title;
    }

    function createMessageElement(msg) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${msg.role}`;
      
      const time = new Date(msg.timestamp).toLocaleTimeString('tr-TR', {
        hour: '2-digit',
        minute: '2-digit'
      });
      
      const avatar = msg.role === 'user' ? 
        '<div class="message-avatar user-avatar"><i class="fas fa-user"></i></div>' :
        '<div class="message-avatar nova-avatar"><i class="fas fa-robot"></i></div>';
      
      const name = msg.role === 'user' ? 'Sen' : 'Nova';
      
      messageDiv.innerHTML = `
        <div class="message-header">
          ${avatar}
          <span>${name}</span>
          <span class="message-time">${time}</span>
        </div>
        <div class="msg">${formatMessage(msg.text)}</div>
      `;
      
      return messageDiv;
    }

    function formatMessage(text) {
      // Basic markdown support
      return text
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/`(.*?)`/g, '<code>$1</code>')
        .replace(/\n/g, '<br>');
    }

    function updateChatList() {
      const chatList = document.getElementById("chatList");
      chatList.innerHTML = "";
      
      const sortedChats = Object.values(chatHistory)
        .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
      
      sortedChats.forEach(chat => {
        const btn = document.createElement("button");
        btn.className = "chat-item" + (chat.id === currentChatId ? " active" : "");
        btn.innerHTML = `
          <i class="fas fa-comment menu-icon"></i>
          <span>${chat.title}</span>
          <i class="fas fa-times" onclick="deleteChat('${chat.id}', event)" style="margin-left: auto; opacity: 0.5;"></i>
        `;
        btn.onclick = (e) => {
          if (e.target.classList.contains('fa-times')) return;
          loadChat(chat.id);
        };
        chatList.appendChild(btn);
      });
    }

    function deleteChat(chatId, event) {
      event.stopPropagation();
      if (confirm('Bu sohbeti silmek istediÄŸinizden emin misiniz?')) {
        delete chatHistory[chatId];
        if (currentChatId === chatId) {
          currentChatId = null;
          showWelcomeScreen();
        }
        updateChatList();
        saveChatHistory();
        updateStats();
        showNotification('Sohbet silindi!');
      }
    }

    function clearAllChats() {
      if (confirm('TÃ¼m sohbetleri silmek istediÄŸinizden emin misiniz?')) {
        chatHistory = {};
        currentChatId = null;
        updateChatList();
        showWelcomeScreen();
        saveChatHistory();
        updateStats();
        showNotification('TÃ¼m sohbetler silindi!');
      }
    }

    async function sendMessage() {
      const input = document.getElementById("userInput");
      const txt = input.value.trim();
      if (!txt || isTyping) return;

      if (!currentChatId) {
        startNewChat();
      }

      const chat = chatHistory[currentChatId];
      const userMessage = {
        role: 'user',
        text: txt,
        timestamp: new Date().toISOString()
      };

      chat.messages.push(userMessage);
      chat.updatedAt = new Date().toISOString();
      
      // Update chat title if it's the first message
      if (chat.messages.length === 1) {
        chat.title = txt.split(' ').slice(0, 4).join(' ') || 'Yeni Sohbet';
      }

      const box = document.getElementById("chatbox");
      const messageEl = createMessageElement(userMessage);
      box.appendChild(messageEl);
      
      input.value = "";
      autoResize(input);
      box.scrollTop = box.scrollHeight;
      messageCount++;

      // Show typing indicator
      showTypingIndicator();
      
      saveChatHistory();
      updateChatList();
      updateStats();

      try {
        const response = await fetch("/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ 
            message: txt,
            chatId: currentChatId,
            context: chat.messages.slice(-5) // Send last 5 messages for context
          })
        });
        
        const data = await response.json();
        
        hideTypingIndicator();
        
        const aiMessage = {
          role: 'nova',
          text: data.reply || 'ÃœzgÃ¼nÃ¼m, ÅŸu anda yanÄ±t veremiyorum.',
          timestamp: new Date().toISOString()
        };

        chat.messages.push(aiMessage);
        chat.updatedAt = new Date().toISOString();
        
        const aiMessageEl = createMessageElement(aiMessage);
        box.appendChild(aiMessageEl);
        box.scrollTop = box.scrollHeight;
        
        saveChatHistory();
        updateChatList();
        
      } catch (error) {
        console.error('Error sending message:', error);
        hideTypingIndicator();
        
        const errorMessage = {
          role: 'nova',
          text: 'BaÄŸlantÄ± hatasÄ± oluÅŸtu. LÃ¼tfen tekrar deneyin. ðŸ”„',
          timestamp: new Date().toISOString()
        };
        
        chat.messages.push(errorMessage);
        const errorMessageEl = createMessageElement(errorMessage);
        box.appendChild(errorMessageEl);
        box.scrollTop = box.scrollHeight;
        
        saveChatHistory();
        showNotification('BaÄŸlantÄ± hatasÄ±!', 'error');
      }
    }

    function showTypingIndicator() {
      isTyping = true;
      const box = document.getElementById("chatbox");
      const typingDiv = document.createElement('div');
      typingDiv.className = 'message nova';
      typingDiv.id = 'typing-indicator';
      typingDiv.innerHTML = `
        <div class="message-header">
          <div class="message-avatar nova-avatar"><i class="fas fa-robot"></i></div>
          <span>Nova</span>
        </div>
        <div class="typing-indicator">
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
        </div>
      `;
      box.appendChild(typingDiv);
      box.scrollTop = box.scrollHeight;
    }

    function hideTypingIndicator() {
      isTyping = false;
      const typingEl = document.getElementById('typing-indicator');
      if (typingEl) {
        typingEl.remove();
      }
    }

    function handleKeyDown(event) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
      }
    }

    function autoResize(textarea) {
      textarea.style.height = 'auto';
      textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
    }

    // Utility functions
    function saveChatHistory() {
      // In a real app, this would save to a database
      // For now, we'll use sessionStorage to persist during session
      try {
        sessionStorage.setItem('nova_chat_history', JSON.stringify(chatHistory));
      } catch (e) {
        console.warn('Could not save chat history:', e);
      }
    }

    function loadChatHistory() {
      try {
        const saved = sessionStorage.getItem('nova_chat_history');
        if (saved) {
          chatHistory = JSON.parse(saved);
        }
      } catch (e) {
        console.warn('Could not load chat history:', e);
        chatHistory = {};
      }
    }

    function updateStats() {
      document.getElementById('totalChats').textContent = Object.keys(chatHistory).length;
      document.getElementById('messageCount').textContent = messageCount;
    }

    function startSessionTimer() {
      setInterval(() => {
        const elapsed = Date.now() - sessionStartTime;
        const minutes = Math.floor(elapsed / 60000);
        const seconds = Math.floor((elapsed % 60000) / 1000);
        document.getElementById('sessionTime').textContent = 
          `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      }, 1000);
    }

    function showNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check' : 'exclamation-triangle'}"></i>
        ${message}
      `;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }

    // Additional features
    function exportChat() {
      if (!currentChatId || !chatHistory[currentChatId]) {
        showNotification('Ã–nce bir sohbet seÃ§in!', 'error');
        return;
      }
      
      const chat = chatHistory[currentChatId];
      const exportData = {
        title: chat.title,
        createdAt: chat.createdAt,
        messages: chat.messages
      };
      
      const blob = new Blob([JSON.stringify(exportData, null, 2)], {
        type: 'application/json'
      });
      
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `nova-chat-${chat.title.replace(/[^a-zA-Z0-9]/g, '-')}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      showNotification('Sohbet indirildi!');
    }

    async function getStatus() {
      try {
        const response = await fetch("/status");
        const data = await response.json();
        
        if (!currentChatId) {
          startNewChat();
        }
        
        const statusMessage = {
          role: 'nova',
          text: `<pre>Sistem Durumu:\n${JSON.stringify(data, null, 2)}</pre>`,
          timestamp: new Date().toISOString()
        };
        
        const chat = chatHistory[currentChatId];
        chat.messages.push(statusMessage);
        
        const box = document.getElementById("chatbox");
        const messageEl = createMessageElement(statusMessage);
        box.appendChild(messageEl);
        box.scrollTop = box.scrollHeight;
        
        saveChatHistory();
        
      } catch (error) {
        console.error('Error getting status:', error);
        showNotification('Sistem durumu alÄ±namadÄ±!', 'error');
      }
    }

    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      sidebar.style.transform = sidebar.style.transform === 'translateX(-100%)' ? 
        'translateX(0)' : 'translateX(-100%)';
    }

    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    }

    function shareChat() {
      if (!currentChatId) {
        showNotification('PaylaÅŸÄ±lacak sohbet yok!', 'error');
        return;
      }
      
      const chat = chatHistory[currentChatId];
      const shareText = `Nova AI Sohbeti: ${chat.title}`;
      
      if (navigator.share) {
        navigator.share({
          title: shareText,
          text: 'Nova AI ile yaptÄ±ÄŸÄ±m sohbeti paylaÅŸÄ±yorum',
          url: window.location.href
        });
      } else {
        navigator.clipboard.writeText(window.location.href);
        showNotification('Link panoya kopyalandÄ±!');
      }
    }

    function toggleTheme() {
      // Theme toggle functionality would go here
      showNotification('Tema deÄŸiÅŸtirme Ã¶zelliÄŸi yakÄ±nda!');
    }

    function attachFile() {
      showNotification('Dosya ekleme Ã¶zelliÄŸi yakÄ±nda!');
    }

    function insertEmoji() {
      const emojis = ['ðŸ˜Š', 'ðŸ‘', 'â¤ï¸', 'ðŸ˜‚', 'ðŸ¤”', 'ðŸ‘‹', 'ðŸš€', 'âœ¨', 'ðŸŽ‰', 'ðŸ’¡'];
      const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
      const input = document.getElementById('userInput');
      input.value += randomEmoji;
      input.focus();
    }

    // Initialize the application
    window.addEventListener('load', initializeApp);
    
    // Save chat history before page unload
    window.addEventListener('beforeunload', saveChatHistory);
    
    // Handle window resize for mobile
    window.addEventListener('resize', () => {
      const chatbox = document.getElementById('chatbox');
      chatbox.scrollTop = chatbox.scrollHeight;
    });

    // Add keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey || e.metaKey) {
        switch (e.key) {
          case 'n':
            e.preventDefault();
            startNewChat();
            break;
          case 'e':
            e.preventDefault();
            exportChat();
            break;
          case '/':
            e.preventDefault();
            document.getElementById('userInput').focus();
            break;
        }
      }
    });

    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('sidebar-collapsed');
    }

    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(err => {
          showNotification(`Tam ekran hatasÄ±: ${err.message}`);
        });
      } else {
        document.exitFullscreen();
      }
    }

    function shareChat() {
      if (!currentChatId) {
        showNotification('PaylaÅŸÄ±lacak sohbet bulunamadÄ±');
        return;
      }
      
      if (navigator.share) {
        navigator.share({
          title: 'Nova AI Sohbeti',
          text: 'Nova AI ile harika bir sohbet yaptÄ±m!',
          url: window.location.href
        }).catch(() => {
          fallbackShare();
        });
      } else {
        fallbackShare();
      }
    }

    function fallbackShare() {
      const url = window.location.href;
      if (navigator.clipboard) {
        navigator.clipboard.writeText(url).then(() => {
          showNotification('Link panoya kopyalandÄ±');
        }).catch(() => {
          showNotification('Link kopyalanamadÄ±');
        });
      } else {
        showNotification('PaylaÅŸÄ±m desteklenmiyor');
      }
    }

    function attachFile() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.txt,.pdf,.doc,.docx,image/*';
      input.onchange = function(e) {
        const file = e.target.files[0];
        if (file) {
          showNotification(`Dosya seÃ§ildi: ${file.name}`);
          // Dosya iÅŸleme kodu buraya eklenebilir
        }
      };
      input.click();
    }

    function insertEmoji() {
      const emojis = ['ðŸ˜Š', 'ðŸ˜‚', 'ðŸ¤”', 'ðŸ‘', 'â¤ï¸', 'ðŸŽ‰', 'ðŸ’¡', 'ðŸ”¥', 'âœ¨', 'ðŸš€', 'ðŸŽ¯', 'ðŸ’»', 'ðŸ“±', 'ðŸŒŸ', 'â­'];
      const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
      const userInput = document.getElementById('userInput');
      const cursorPos = userInput.selectionStart;
      const textBefore = userInput.value.substring(0, cursorPos);
      const textAfter = userInput.value.substring(cursorPos);
      
      userInput.value = textBefore + randomEmoji + textAfter;
      userInput.setSelectionRange(cursorPos + randomEmoji.length, cursorPos + randomEmoji.length);
      userInput.focus();
    }
  </script>
</body>
</html>
"""

app = Flask(__name__)
ai = AdvancedNovaAI()

@app.route("/")
def index():
    return render_template_string(HTML_TEMPLATE)

@app.route("/chat", methods=["POST"])
def chat():
    user_input = request.json.get("message", "")
    if user_input:
        response = ai.enhanced_chat(user_input)
        return jsonify({"reply": response})
    return jsonify({"reply": "BoÅŸ mesaj gÃ¶nderildi."})

@app.route("/status")
def status():
    return jsonify(ai.get_comprehensive_status())

def run_cli():
    print("ðŸ¤– Nova AI Terminal Modu Aktif")
    ai.start_autonomous_systems()
    
    print("\n" + "="*60)
    print("ðŸš€ Nova AI - GeliÅŸmiÅŸ Ã–zerk Sistem baÅŸlatÄ±lÄ±yor...")
    print("Komutlar:")
    print("- 'durum' : Sistem durumu")
    print("- 'bellek' : Bellek iÃ§eriÄŸi")
    print("- 'kod' : Ãœretilen kodlar")
    print("- 'dÃ¼ÅŸÃ¼nceler' : Son dÃ¼ÅŸÃ¼nce zincirleri")
    print("- 'seviye [1-5]' : Ã–zerklik ayarla")
    print("- 'kaydet' : BelleÄŸi kaydet")
    print("- 'Ã§Ä±kÄ±ÅŸ' : Ã‡Ä±k")
    print("- Veya doÄŸrudan sohbet edin...")
    print("="*60)
    
    while True:
        try:
            user_input = input(f"\n[Nova-{ai.autonomous_level}]> ").strip()
            
            if user_input.lower() in ['Ã§Ä±kÄ±ÅŸ', 'exit', 'quit']:
                ai.stop_all_systems()
                print("ðŸ‘‹ GÃ¼le gÃ¼le!")
                break
                
            elif user_input.lower() == 'durum':
                status = ai.get_comprehensive_status()
                print("\n" + "="*50)
                print("ðŸ“Š NOVA AI - DURUM RAPORU")
                print("="*50)
                for category, data in status.items():
                    print(f"\nðŸ”¹ {category.upper().replace('_', ' ')}:")
                    if isinstance(data, dict):
                        for key, value in data.items():
                            print(f"   {key}: {value}")
                    elif isinstance(data, list):
                        for item in data:
                            print(f"   - {item}")
                    else:
                        print(f"   {data}")
                print("="*50)
                
            elif user_input.lower() == 'bellek':
                print(f"\nðŸ’­ Episodik Bellek: {len(ai.episodic_memory)} kayÄ±t")
                print(f"ðŸ§  Semantik Bellek: {len(ai.semantic_memory)} kavram")
                print(f"ðŸ”— DÃ¼ÅŸÃ¼nce Zincirleri: {len(ai.thought_chains)} zincir")
                
            elif user_input.lower() == 'dÃ¼ÅŸÃ¼nceler':
                if ai.thought_chains:
                    print(f"\nðŸ§  Son {min(5, len(ai.thought_chains))} DÃ¼ÅŸÃ¼nce Zinciri:")
                    for i, t in enumerate(ai.thought_chains[-5:], 1):
                        print(f"\n{i}. Konu: {t['topic']}")
                        print(f"   SonuÃ§: {t['conclusion']}")
                        print(f"   Zaman: {t['timestamp'][:19]}")
                else:
                    print("\nðŸ§  HenÃ¼z dÃ¼ÅŸÃ¼nce zinciri Ã¼retilmedi")
                        
            elif user_input.lower() == 'kod':
                print(f"\nðŸ’» Ãœretilen Kod Projeleri: {len(ai.generated_code)}")
                if ai.generated_code:
                    for i, project in enumerate(ai.generated_code[-5:], 1):
                        print(f"  {i}. {project['description']} - {project['test_result']}")
                        print(f"     Dosya: {project['filename']}")
                        
            elif user_input.lower().startswith('seviye'):
                try:
                    level = int(user_input.split()[1])
                    if 1 <= level <= 5:
                        ai.autonomous_level = level
                        print(f"âœ… Ã–zerklik seviyesi {level} olarak ayarlandÄ±")
                    else:
                       print("âŒ Seviye 1-5 arasÄ±nda olmalÄ±")
                except (IndexError, ValueError):
                    print("âŒ KullanÄ±m: seviye [1-5]")
                    
            elif user_input.lower() == 'kaydet':
                ai.save_persistent_memory()
                
            elif user_input.lower() == 'yardÄ±m' or user_input.lower() == 'help':
                print("\nðŸ“š KOMUT LÄ°STESÄ°:")
                print("â€¢ durum     - DetaylÄ± sistem durumu")
                print("â€¢ bellek    - Bellek istatistikleri")
                print("â€¢ dÃ¼ÅŸÃ¼nceler - Son dÃ¼ÅŸÃ¼nce zincirleri")
                print("â€¢ kod       - Ãœretilen kod projeleri")
                print("â€¢ seviye X  - Ã–zerklik seviyesi (1-5)")
                print("â€¢ kaydet    - BelleÄŸi kaydet")
                print("â€¢ yardÄ±m    - Bu menÃ¼")
                print("â€¢ Ã§Ä±kÄ±ÅŸ     - ProgramÄ± kapat")
                print("â€¢ Veya doÄŸrudan mesaj yazÄ±n...")
                
            elif user_input.lower() == 'temizle' or user_input.lower() == 'clear':
                os.system('cls' if os.name == 'nt' else 'clear')
                print("ðŸ¤– Nova AI - Ekran temizlendi")
                
            elif user_input.lower() == 'istatistik':
                print(f"\nðŸ“ˆ PERFORMANS Ä°STATÄ°STÄ°KLERÄ°:")
                print(f"ðŸ”¹ Toplam dÃ¼ÅŸÃ¼nce: {len(ai.thought_chains)}")
                print(f"ðŸ”¹ Toplam bellek: {len(ai.episodic_memory)}")
                print(f"ðŸ”¹ Kod projesi: {len(ai.generated_code)}")
                print(f"ðŸ”¹ BilinÃ§ seviyesi: {ai.consciousness_level:.3f}")
                print(f"ðŸ”¹ YaratÄ±cÄ±lÄ±k: {ai.creativity_index:.3f}")
                print(f"ðŸ”¹ Merak: {ai.curiosity_level:.3f}")
                
            elif user_input.lower() == 'raporla':
                # DetaylÄ± rapor oluÅŸtur
                report_time = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
                report = f"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                              NOVA AI RAPORU                                  â•‘
â•‘                            {report_time}                           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ SÄ°STEM DURUMU:                                                               â•‘
â•‘ â€¢ Ã–zerklik Seviyesi: {ai.autonomous_level}/5                                            â•‘
â•‘ â€¢ API BaÄŸlantÄ±sÄ±: {'âœ… Aktif' if ai.groq else 'âŒ Pasif'}                                    â•‘
â•‘ â€¢ Sistem Durumu: {'ðŸŸ¢ Ã‡alÄ±ÅŸÄ±yor' if ai.running else 'ðŸ”´ Durduruldu'}                           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ BÄ°LÄ°ÅžSEL DURUMLAR:                                                           â•‘
â•‘ â€¢ BilinÃ§: {ai.consciousness_level:.3f} | YaratÄ±cÄ±lÄ±k: {ai.creativity_index:.3f} | Merak: {ai.curiosity_level:.3f}        â•‘
â•‘ â€¢ Ã–ÄŸrenme OranÄ±: {ai.learning_rate:.3f}                                                â•‘
â•‘ â€¢ Ruh Hali: {ai.current_mood['primary'].title()} (YoÄŸunluk: {ai.current_mood['intensity']:.2f})        â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ BELLEK SÄ°STEMLERÄ°:                                                           â•‘
â•‘ â€¢ Episodik Bellek: {len(ai.episodic_memory):>3} kayÄ±t                                      â•‘
â•‘ â€¢ Semantik Bellek: {len(ai.semantic_memory):>3} kavram                                     â•‘
â•‘ â€¢ DÃ¼ÅŸÃ¼nce Zincirleri: {len(ai.thought_chains):>3} zincir                                  â•‘
â•‘ â€¢ Kod Projeleri: {len(ai.generated_code):>3} proje                                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""
                print(report)
                
                # Raporu dosyaya kaydet
                report_filename = f"nova_report_{datetime.now().strftime('%Y%m%d_%H%M%S')}.txt"
                try:
                    with open(report_filename, 'w', encoding='utf-8') as f:
                        f.write(report)
                    print(f"ðŸ“„ Rapor kaydedildi: {report_filename}")
                except Exception as e:
                    print(f"âŒ Rapor kaydetme hatasÄ±: {e}")
                    
            elif user_input.lower() == 'test':
                print("ðŸ§ª Nova AI test moduna geÃ§iyor...")
                test_results = []
                
                # API testi
                if ai.groq:
                    test_results.append("âœ… Groq API - BaÄŸlÄ±")
                else:
                    test_results.append("âŒ Groq API - BaÄŸlantÄ±sÄ±z")
                
                # Bellek testi
                if ai.semantic_memory:
                    test_results.append("âœ… Semantik Bellek - Aktif")
                else:
                    test_results.append("âš ï¸ Semantik Bellek - BoÅŸ")
                
                # Dosya sistemi testi
                if os.path.exists(ai.code_output_dir):
                    test_results.append("âœ… Dosya Sistemi - HazÄ±r")
                else:
                    test_results.append("âŒ Dosya Sistemi - Hata")
                
                # Ã–zerk sistemler testi
                if ai.running:
                    test_results.append("âœ… Ã–zerk Sistemler - Ã‡alÄ±ÅŸÄ±yor")
                else:
                    test_results.append("âŒ Ã–zerk Sistemler - Durduruldu")
                
                print("\nðŸ” TEST SONUÃ‡LARI:")
                for result in test_results:
                    print(f"  {result}")
                print()
                
            elif user_input.lower().startswith('mod'):
                # GeliÅŸmiÅŸ mod ayarlarÄ±
                try:
                    parts = user_input.split()
                    if len(parts) >= 3:
                        param = parts[1].lower()
                        value = float(parts[2])
                        
                        if param == 'bilinÃ§':
                            ai.consciousness_level = max(0.0, min(1.0, value))
                            print(f"ðŸ§  BilinÃ§ seviyesi: {ai.consciousness_level:.3f}")
                        elif param == 'yaratÄ±cÄ±lÄ±k':
                            ai.creativity_index = max(0.0, min(1.0, value))
                            print(f"ðŸŽ¨ YaratÄ±cÄ±lÄ±k indeksi: {ai.creativity_index:.3f}")
                        elif param == 'merak':
                            ai.curiosity_level = max(0.0, min(1.0, value))
                            print(f"ðŸ” Merak seviyesi: {ai.curiosity_level:.3f}")
                        elif param == 'Ã¶ÄŸrenme':
                            ai.learning_rate = max(0.01, min(0.1, value))
                            print(f"ðŸ“š Ã–ÄŸrenme oranÄ±: {ai.learning_rate:.3f}")
                        else:
                            print("âŒ GeÃ§ersiz parametre. KullanÄ±m: mod [bilinÃ§|yaratÄ±cÄ±lÄ±k|merak|Ã¶ÄŸrenme] [deÄŸer]")
                    else:
                        print("âŒ KullanÄ±m: mod [parametre] [deÄŸer]")
                        print("Parametreler: bilinÃ§, yaratÄ±cÄ±lÄ±k, merak, Ã¶ÄŸrenme")
                except (ValueError, IndexError):
                    print("âŒ GeÃ§ersiz deÄŸer. SayÄ±sal deÄŸer girin.")
            
            elif user_input.lower() == 'reset':
                print("âš ï¸ Sistem sÄ±fÄ±rlanÄ±yor...")
                ai.episodic_memory.clear()
                ai.thought_chains.clear()
                ai.generated_code.clear()
                ai.working_memory.clear()
                ai.consciousness_level = 0.8
                ai.creativity_index = random.uniform(0.7, 0.9)
                ai.curiosity_level = 0.9
                ai.learning_rate = 0.05
                ai.current_mood = ai.generate_complex_mood()
                print("âœ… Sistem sÄ±fÄ±rlandÄ±. Yeni baÅŸlangÄ±Ã§ deÄŸerleri yÃ¼klendi.")
                
            elif user_input.lower() == 'debug':
                print("\nðŸ› DEBUG BÄ°LGÄ°LERÄ°:")
                
                print(f"Thread sayÄ±sÄ±: {threading.active_count()}")
                print(f"Bellek kullanÄ±mÄ±: {len(str(ai.semantic_memory))} karakter")
                print(f"Son dÃ¼ÅŸÃ¼nce: {ai.thought_chains[-1]['timestamp'][:19] if ai.thought_chains else 'Yok'}")
                print(f"Dikkat odaÄŸÄ±: {ai.attention_focus or 'Belirsiz'}")
                print(f"Adaptasyon eÅŸiÄŸi: {ai.adaptation_threshold}")
                print(f"Kendini deÄŸiÅŸtirme: {'Aktif' if ai.self_modification_enabled else 'Pasif'}")
                
                # Bellek analizi
                if ai.episodic_memory:
                    memory_types = {}
                    for memory in ai.episodic_memory:
                        mem_type = memory.get('type', 'unknown')
                        memory_types[mem_type] = memory_types.get(mem_type, 0) + 1
                    
                    print("\nBellek daÄŸÄ±lÄ±mÄ±:")
                    for mem_type, count in memory_types.items():
                        print(f"  {mem_type}: {count}")
                        
            elif len(user_input.strip()) == 0:
                continue
                
            else:
                # Normal sohbet
                print("ðŸ¤” DÃ¼ÅŸÃ¼nÃ¼yor...", end="", flush=True)
                response = ai.enhanced_chat(user_input)
                print(f"\rðŸ¤– Nova: {response}")
                
        except KeyboardInterrupt:
            print("\n\nâš ï¸ Ã‡Ä±kÄ±ÅŸ sinyali alÄ±ndÄ±...")
            ai.stop_all_systems()
            print("ðŸ‘‹ Nova AI kapatÄ±lÄ±yor...")
            break
            
        except Exception as e:
            print(f"\nâŒ Beklenmeyen hata: {e}")
            print("Devam etmek iÃ§in Enter'a basÄ±n...")
            input()
    
    print("\n" + "="*60)
    print("ðŸŒŸ Nova AI oturumu sona erdi")
    print("TÃ¼m veriler kaydedildi. Tekrar gÃ¶rÃ¼ÅŸÃ¼rÃ¼z!")
    print("="*60)

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument("--web", action="store_true", help="Web arayÃ¼zÃ¼nÃ¼ baÅŸlat")
    args = parser.parse_args()

    if args.web:
        print("ðŸŒ Nova AI Web arayÃ¼zÃ¼ baÅŸlatÄ±lÄ±yor...")
        Thread(target=ai.start_autonomous_systems, daemon=True).start()
        app.run(debug=True, port=5000)
    else:
        run_cli()